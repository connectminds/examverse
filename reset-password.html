<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reset Password — ExamVerse</title>
<style>
:root{--accent:#004aad;--glass:rgba(0,0,0,0.15)}
html,body{height:100%;margin:0;font-family:Poppins,sans-serif}
#bubbles-bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  background: linear-gradient(135deg, #001f4d, #003366); /* Dark blue gradient */
  overflow: hidden;
}
.bubble{position:absolute;border-radius:50%;opacity:.6;background:rgba(255,255,255,.18);animation:rise 15s linear infinite}
@keyframes rise{0%{transform:translateY(100vh) scale(1);opacity:.3}50%{opacity:.6}100%{transform:translateY(-10vh) scale(1.5);opacity:0}}
.wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
.card{width:100%;max-width:420px;background:var(--glass);backdrop-filter:blur(10px);padding:36px;border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,.35);color:#fff}
h1{margin:0 0 8px;font-size:22px}
p.lead{margin:0 0 18px;color:#cfe8ff}
input{width:100%;padding:12px;border-radius:10px;border:none;background: rgba(255,255,255,0.06);color:#fff;margin-bottom:12px;font-size:15px}
button.primary{width:100%;padding:12px;border-radius:10px;border:none;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;transition:transform .15s,background .15s}
button.primary:hover{transform:translateY(-2px);background:#00347a}
.msg{display:none;padding:12px;border-radius:8px;margin-top:12px;font-size:14px}
.msg.success{background:rgba(0,255,150,.12);color:#00ff96}
.msg.error{background:rgba(255,50,50,.12);color:#ff5555}
a.back{display:inline-block;margin-top:12px;color:#aaddff;text-decoration:none}
</style>
</head>
<body>
<div id="bubbles-bg"></div>
<div class="wrap">
<div class="card">
<h1>Set a new password</h1>
<p class="lead">Enter and confirm your new password.</p>
<form id="resetForm">
<input type="password" name="newPassword" placeholder="New password" minlength="8" required>
<input type="password" name="confirmPassword" placeholder="Confirm password" minlength="8" required>
<button class="primary" type="submit">Reset password</button>
</form>
<div class="msg success" id="successMsg"></div>
<div class="msg error" id="errorMsg"></div>
<a href="login.html" class="back">← Back to login</a>
</div>
</div>
<script>
const bg=document.getElementById('bubbles-bg');
for(let i=0;i<25;i++){const d=document.createElement('div');d.className='bubble';const s=10+Math.random()*40;d.style.width=s+'px';d.style.height=s+'px';d.style.left=(Math.random()*100)+'%';d.style.top=(Math.random()*100)+'%';d.style.animationDuration=(10+Math.random()*10)+'s';d.style.animationDelay=(Math.random()*5)+'s';bg.appendChild(d);}
const form=document.getElementById('resetForm'),successMsg=document.getElementById('successMsg'),errorMsg=document.getElementById('errorMsg');
const params=new URLSearchParams(window.location.search);
const token=params.get('token');
if(!token){errorMsg.textContent='Invalid or missing token.';errorMsg.style.display='block';form.style.display='none';}
form.addEventListener('submit', async e=>{
e.preventDefault();successMsg.style.display='none';errorMsg.style.display='none';
const newPassword=form.newPassword.value.trim();
const confirm=form.confirmPassword.value.trim();
if(newPassword!==confirm){errorMsg.textContent='Passwords do not match.';errorMsg.style.display='block';return;}
try{
const res=await fetch('/api/reset-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,newPassword})});
const data=await res.json();
res.ok?(successMsg.textContent=data.message||'Password reset successfully!',successMsg.style.display='block',setTimeout(()=>window.location.href='login.html',1800))
:(errorMsg.textContent=data.message||'Failed to reset password',errorMsg.style.display='block');
}catch(err){errorMsg.textContent='Network error. Try again later.';errorMsg.style.display='block';console.error(err);}
});
</script>
</body>
</html>
